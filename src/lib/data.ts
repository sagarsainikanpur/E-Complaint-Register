import type { Complaint, ComplaintStatus } from '@/lib/types';

// This is a mock in-memory database.
let complaints: Complaint[] = [];
let nextId = 3;

// Seed with some initial data for demonstration
if (process.env.NODE_ENV !== 'production' && complaints.length === 0) {
  complaints.push({
    id: '1',
    userName: 'John Doe',
    roomNumber: '101',
    section: 'Cardiology',
    cpuSerialNumber: 'CPU-12345',
    problemDescription: 'Computer is not turning on. Power supply seems to be faulty. Checked all cables and power outlets, but the machine is completely unresponsive. No lights, no fan spin.',
    userSignature: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAARgAAACACAYAAACg8G6sAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAdXSURBVHhe7d3Nbhw5EARQvX+pf5/mB00rGxJKkGQ/kgyvM4wBNpZlWfbX/h7APz5+/Phx/sXb7e+PAG4L0Q3i3hD/3g/x48ePHz8BAcbjxyk3iHtD/BfxEONH8R+iG8TzR4w/x48fP34CAszjR4/rR4/rR4/rR49j/Gg+jX+PHz9+/AQCzOPHcZ3rR4/rR4/rR4/rR49j/Gh+E/8eP378+AkIMJ8fP378eCjGj+LHiB8/fgICzOPHj+M6148e148e148e148ex/jR/Cb+PX78+PEhIMB8fvx4XCM/x3WOG3/G40eP60eP4zrHjX9/PHz8+AkIMJ8fP378eCjGj+LHiB8/fgICzOPHj+M6148e148e148e148ex/jR/Cb+PX78+PEhIMB8fvx4XCM/x3WOG3/G40eP60eP4zrHjX9/PHz8+AkIMJ8fP378eCjGj+LHiB8/fgICzOPHj+M6148e148e148e148ex/jR/Cb+PX78+PEhIMB8fvx4XCM/x3WOG3/G40eP60eP4zrHjX9/PHz8+AkIMJ8fP378eCjGj+LHiB8/fgICzOPHj+M6148e148e148e148ex/jR/Cb+PX78+PEhIMB8fvx4XCM/x3WOG3/G40eP60eP4zrHjX9/PHz8+AkIMJ8fP378eCjGj+LHiB8/fgICzOPHj+M6148e148e148e148ex/jR/Cb+PX78+PEhIMB8fvx4XCM/x3WOG3/G40eP60eP4zrHjX9/PHz8+AkIMJ8fP378eCjGj+LHiB8/fgICzOPHj+M6148e148e148e148ex/jR/Cb+PX78+PEhIMB8fvx4XCM/x3WOG3/G40eP60eP4zrHjX9/PHz8+AkIMJ8fP378eCjGj+LHiB8/fgICzOPHj+M6148e148e148e148ex/jR/Cb+PX78+PEhIMB8fvx4XCM/x3WOG3/G40eP60eP4zrHjX9/PHz8+AkIMJ8fP378eCjGj+LHiB8/fgICzOPHj+M6148e148e148e148ex/jR/Cb+PX78+PEhIMB8fvx4XCM/x3WOG3/G40eP60eP4zrHjX9/PHz8+AkIMJ8fP378eCjGj+LHiB8/fgICzOPHj+M6148e148e148e148ex/jR/Cb+PX78+PEhIMB8fvx4XCM/x3WOG3/G40eP60eP4zrHjX9/PHz8+AkIMJ8fP378eCjGj+LHiB8/fgICzOPHj+M6148e148e148e148ex/jR/Cb+PX78+PEhIMB8fvx4XCM/x3WOG3/G40eP60eP4zrHjX9/PHz8+AkIMJ8fP378eCjGj+LHiB8/fgICzOPHj+M6148e148e148e148ex/jR/Cb+PX78+PEhIMB8fvx4XCM/x3WOG3/G40eP60eP4zrHjX9/PHz8+AkIMJ8fP378eCjGj+LHiB8/fgICzOPHj+M6148e148e148e148ex/jR/Cb+PX78+PEhIMB8fvx4XCM/x3WOG3/G40eP60eP4zrHjX9/PHz8+AkIMJ8fP378eCjGj+LHiB8/fgICzOPHj+M6148e148e148e148ex/jR/Cb+PX78+PEhIMB8fvx4XCM/x3WOG3/G40eP60eP4zrHjX9/PHz8+AkIMJ8fP378eCjGj+LHiB8/fgICzOPHj+M6148e148e148e148ex/jR/Cb+PX78+PEhIMB8fvx4XCM/x3WOG3/G40eP60eP4zrHjX9/PHz8+AkIMJ8fP378eCjGj+LHiB8/fgICzOPHj+M6148e148e148e148ex/jR/Cb+PX78+PEhIMB8fvx4XCM/x3WOG3/G40eP60eP4zrHjX9/PHz8+AkIMJ8fP378eCjGj+LHiB8/fgICzOPHj+M6148e148e148e148ex/jR/Cb+PX78+PEhIMB8fvx4XCM/x3WOG3/G40eP60eP4zrHjX9/PHz8+AkIMJ8fP378eCjGj+LHiB8/fgICzOPHj+M6148e148e148e148ex/jR/Cb+PX78+PEhIMB8fvx4XCM/x3WOG3/G40eP60eP4zrHjX9/PHz8+AkIMJ8fP378eCjGj+LHiB8/fgICzOPHj+M6148e148e148e148ex/jR/Cb+PX78+PEhIMB8fvx4XCM/x3WOG3/G40eP60eP4zrHjX9/PHz8+AkIMJ8fP378+AHA/weAP378+PEA8U/8AwBs4uD9m2E+AAAAAElFTkSuQmCC',
    representativeName: 'Jane Smith',
    solution: 'Replaced the power supply unit. System is now booting up correctly. Verified all connections and ran diagnostics. All tests passed.',
    representativeSignature: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAARgAAACACAYAAACg8G6sAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAfASURBVHhe7d1NbuNAEATQvf+lf5/mB00LgQEk6Z5kyvIsw4C0LCvy7O+v/T2Af3z8+PHj/Iu3298fAWwL0Q3i3hD/3g/x48ePHz8BAcbjxyk3iHtD/BfxEONH8R+iG8TzR4w/x48fP34CAszjR4/rR4/rR4/rR49j/Gg+jX+PHz9+/AQCzOPHcZ3rR4/rR4/rR4/rR49j/Gh+E/8eP378+AkIMJ8fP378eCjGj+LHiB8/fgICzOPHj+M6148e148e148e148ex/jR/Cb+PX78+PEhIMB8fvx4XCM/x3WOG3/G40eP60eP4zrHjX9/PHz8+AkIMJ8fP378eCjGj+LHiB8/fgICzOPHj+M6148e148e148e148ex/jR/Cb+PX78+PEhIMB8fvx4XCM/x3WOG3/G40eP60eP4zrHjX9/PHz8+AkIMJ8fP378eCjGj+LHiB8/fgICzOPHj+M6148e148e148e148ex/jR/Cb+PX78+PEhIMB8fvx4XCM/x3WOG3/G40eP60eP4zrHjX9/PHz8+AkIMJ8fP378eCjGj+LHiB8/fgICzOPHj+M6148e148e148e148ex/jR/Cb+PX78+PEhIMB8fvx4XCM/x3WOG3/G40eP60eP4zrHjX9/PHz8+AkIMJ8fP378eCjGj+LHiB8/fgICzOPHj+M6148e148e148e148ex/jR/Cb+PX78+PEhIMB8fvx4XCM/x3WOG3/G40eP60eP4zrHjX9/PHz8+AkIMJ8fP378eCjGj+LHiB8/fgICzOPHj+M6148e148e148e148ex/jR/Cb+PX78+PEhIMB8fvx4XCM/x3WOG3/G40eP60eP4zrHjX9/PHz8+AkIMJ8fP378eCjGj+LHiB8/fgICzOPHj+M6148e148e148e148ex/jR/Cb+PX78+PEhIMB8fvx4XCM/x3WOG3/G40eP60eP4zrHjX9/PHz8+AkIMJ8fP378eCjGj+LHiB8/fgICzOPHj+M6148e148e148e148ex/jR/Cb+PX78+PEhIMB8fvx4XCM/x3WOG3/G40eP60eP4zrHjX9/PHz8+AkIMJ8fP378eCjGj+LHiB8/fgICzOPHj+M6148e148e148e148ex/jR/Cb+PX78+PEhIMB8fvx4XCM/x3WOG3/G40eP60eP4zrHjX9/PHz8+AkIMJ8fP378eCjGj+LHiB8/fgICzOPHj+M6148e148e148e148ex/jR/Cb+PX78+PEhIMB8fvx4XCM/x3WOG3/G40eP60eP4zrHjX9/PHz8+AkIMJ8fP378eCjGj+LHiB8/fgICzOPHj+M6148e148e148e148ex/jR/Cb+PX78+PEhIMB8fvx4XCM/x3WOG3/G40eP60eP4zrHjX9/PHz8+AkIMJ8fP378eCjGj+LHiB8/fgICzOPHj+M6148e148e148e148ex/jR/Cb+PX78+PEhIMB8fvx4XCM/x3WOG3/G40eP60eP4zrHjX9/PHz8+AkIMJ8fP378eCjGj+LHiB8/fgICzOPHj+M6148e148e148e148ex/jR/Cb+PX78+PEhIMB8fvx4XCM/x3WOG3/G40eP60eP4zrHjX9/PHz8+AkIMJ8fP378eCjGj+LHiB8/fgICzOPHj+M6148e148e148e148ex/jR/Cb+PX78+PEhIMB8fvx4XCM/x3WOG3/G40eP60eP4zrHjX9/PHz8+AkIMJ8fP378eCjGj+LHiB8/fgICzOPHj+M6148e148e148e148ex/jR/Cb+PX78+PEhIMB8fvx4XCM/x3WOG3/G40eP60eP4zrHjX9/PHz8+AkIMJ8fP378eCjGj+LHiB8/fgICzOPHj+M6148e148e148e148ex/jR/Cb+PX78+PEhIMB8fvx4XCM/x3WOG3/G40eP60eP4zrHjX9/PHz8+AkIMJ8fP378eCjGj+LHiB8/fgICzOPHj+M6148e148e148e148ex/jR/Cb+PX78+PEhIMB8fvx4XCM/x3WOG3/G40eP60eP4zrHjX9/PHz8+AkIMJ8fP378+AHA/weAP378+PEA8U/8AwDUA23yvJbUuQAAAABJRU5ErkJggg==',
    createdAt: new Date(Date.now() - 2 * 24 * 60 * 60 * 1000).toISOString(),
    status: 'Closed',
  });
  complaints.push({
    id: '2',
    userName: 'Peter Jones',
    roomNumber: '203',
    section: 'Radiology',
    cpuSerialNumber: 'CPU-67890',
    problemDescription: 'Monitor is flickering and showing artifacts.',
    userSignature: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAARgAAACACAYAAACg8G6sAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAdXSURBVHhe7d3Nbhw5EARQvX+pf5/mB00rGxJKkGQ/kgyvM4wBNpZlWfbX/h7APz5+/Phx/sXb7e+PAG4L0Q3i3hD/3g/x48ePHz8BAcbjxyk3iHtD/BfxEONH8R+iG8TzR4w/x48fP34CAszjR4/rR4/rR4/rR49j/Gg+jX+PHz9+/AQCzOPHcZ3rR4/rR4/rR4/rR49j/Gh+E/8eP378+AkIMJ8fP378eCjGj+LHiB8/fgICzOPHj+M6148e148e148e148ex/jR/Cb+PX78+PEhIMB8fvx4XCM/x3WOG3/G40eP60eP4zrHjX9/PHz8+AkIMJ8fP378eCjGj+LHiB8/fgICzOPHj+M6148e148e148e148ex/jR/Cb+PX78+PEhIMB8fvx4XCM/x3WOG3/G40eP60eP4zrHjX9/PHz8+AkIMJ8fP378eCjGj+LHiB8/fgICzOPHj+M6148e148e148e148ex/jR/Cb+PX78+PEhIMB8fvx4XCM/x3WOG3/G40eP60eP4zrHjX9/PHz8+AkIMJ8fP378eCjGj+LHiB8/fgICzOPHj+M6148e148e148e148ex/jR/Cb+PX78+PEhIMB8fvx4XCM/x3WOG3/G40eP60eP4zrHjX9/PHz8+AkIMJ8fP378eCjGj+LHiB8/fgICzOPHj+M6148e148e148e148ex/jR/Cb+PX78+PEhIMB8fvx4XCM/x3WOG3/G40eP60eP4zrHjX9/PHz8+AkIMJ8fP378eCjGj+LHiB8/fgICzOPHj+M6148e148e148e148ex/jR/Cb+PX78+PEhIMB8fvx4XCM/x3WOG3/G40eP60eP4zrHjX9/PHz8+AkIMJ8fP378eCjGj+LHiB8/fgICzOPHj+M6148e148e148e148ex/jR/Cb+PX78+PEhIMB8fvx4XCM/x3WOG3/G40eP60eP4zrHjX9/PHz8+AkIMJ8fP378eCjGj+LHiB8/fgICzOPHj+M6148e148e148e148ex/jR/Cb+PX78+PEhIMB8fvx4XCM/x3WOG3/G40eP60eP4zrHjX9/PHz8+AkIMJ8fP378eCjGj+LHiB8/fgICzOPHj+M6148e148e148e148ex/jR/Cb+PX78+PEhIMB8fvx4XCM/x3WOG3/G40eP60eP4zrHjX9/PHz8+AkIMJ8fP378eCjGj+LHiB8/fgICzOPHj+M6148e148e148e148ex/jR/Cb+PX78+PEhIMB8fvx4XCM/x3WOG3/G40eP60eP4zrHjX9/PHz8+AkIMJ8fP378eCjGj+LHiB8/fgICzOPHj+M6148e148e148e148ex/jR/Cb+PX78+PEhIMB8fvx4XCM/x3WOG3/G40eP60eP4zrHjX9/PHz8+AkIMJ8fP378eCjGj+LHiB8/fgICzOPHj+M6148e148e148e148ex/jR/Cb+PX78+PEhIMB8fvx4XCM/x3WOG3/G40eP60eP4zrHjX9/PHz8+AkIMJ8fP378eCjGj+LHiB8/fgICzOPHj+M6148e148e148e148ex/jR/Cb+PX78+PEhIMB8fvx4XCM/x3WOG3/G40eP60eP4zrHjX9/PHz8+AkIMJ8fP378eCjGj+LHiB8/fgICzOPHj+M6148e148e148e148ex/jR/Cb+PX78+PEhIMB8fvx4XCM/x3WOG3/G40eP60eP4zrHjX9/PHz8+AkIMJ8fP378eCjGj+LHiB8/fgICzOPHj+M6148e148e148e148ex/jR/Cb+PX78+PEhIMB8fvx4XCM/x3WOG3/G40eP60eP4zrHjX9/PHz8+AkIMJ8fP378eCjGj+LHiB8/fgICzOPHj+M6148e148e148e148ex/jR/Cb+PX78+PEhIMB8fvx4XCM/x3WOG3/G40eP60eP4zrHjX9/PHz8+AkIMJ8fP378eCjGj+LHiB8/fgICzOPHj+M6148e148e148e148ex/jR/Cb+PX78+PEhIMB8fvx4XCM/x3WOG3/G40eP60eP4zrHjX9/PHz8+AkIMJ8fP378+AHA/weAP378+PEA8U/8AwBs4uD9m2E+AAAAAElFTkSuQmCC',
    representativeName: 'Jane Smith',
    solution: 'Updated the graphics driver and reseated the display cable. Issue resolved.',
    representativeSignature: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAARgAAACACAYAAACg8G6sAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAfASURBVHhe7d1NbuNAEATQvf+lf5/mB00LgQEk6Z5kyvIsw4C0LCvy7O+v/T2Af3z8+PHj/Iu3298fAWwL0Q3i3hD/3g/x48ePHz8BAcbjxyk3iHtD/BfxEONH8R+iG8TzR4w/x48fP34CAszjR4/rR4/rR4/rR49j/Gg+jX+PHz9+/AQCzOPHcZ3rR4/rR4/rR4/rR49j/Gh+E/8eP378+AkIMJ8fP378eCjGj+LHiB8/fgICzOPHj+M6148e148e148e148ex/jR/Cb+PX78+PEhIMB8fvx4XCM/x3WOG3/G40eP60eP4zrHjX9/PHz8+AkIMJ8fP378eCjGj+LHiB8/fgICzOPHj+M6148e148e148e148ex/jR/Cb+PX78+PEhIMB8fvx4XCM/x3WOG3/G40eP60eP4zrHjX9/PHz8+AkIMJ8fP378eCjGj+LHiB8/fgICzOPHj+M6148e148e148e148ex/jR/Cb+PX78+PEhIMB8fvx4XCM/x3WOG3/G40eP60eP4zrHjX9/PHz8+AkIMJ8fP378eCjGj+LHiB8/fgICzOPHj+M6148e148e148e148ex/jR/Cb+PX78+PEhIMB8fvx4XCM/x3WOG3/G40eP60eP4zrHjX9/PHz8+AkIMJ8fP378eCjGj+LHiB8/fgICzOPHj+M6148e148e148e148ex/jR/Cb+PX78+PEhIMB8fvx4XCM/x3WOG3/G40eP60eP4zrHjX9/PHz8+AkIMJ8fP378eCjGj+LHiB8/fgICzOPHj+M6148e148e148e148ex/jR/Cb+PX78+PEhIMB8fvx4XCM/x3WOG3/G40eP60eP4zrHjX9/PHz8+AkIMJ8fP378eCjGj+LHiB8/fgICzOPHj+M6148e148e148e148ex/jR/Cb+PX78+PEhIMB8fvx4XCM/x3WOG3/G40eP60eP4zrHjX9/PHz8+AkIMJ8fP378eCjGj+LHiB8/fgICzOPHj+M6148e148e148e148ex/jR/Cb+PX78+PEhIMB8fvx4XCM/x3WOG3/G40eP60eP4zrHjX9/PHz8+AkIMJ8fP378eCjGj+LHiB8/fgICzOPHj+M6148e148e148e148ex/jR/Cb+PX78+PEhIMB8fvx4XCM/x3WOG3/G40eP60eP4zrHjX9/PHz8+AkIMJ8fP378eCjGj+LHiB8/fgICzOPHj+M6148e148e148e148ex/jR/Cb+PX78+PEhIMB8fvx4XCM/x3WOG3/G40eP60eP4zrHjX9/PHz8+AkIMJ8fP378eCjGj+LHiB8/fgICzOPHj+M6148e148e148e148ex/jR/Cb+PX78+PEhIMB8fvx4XCM/x3WOG3/G40eP60eP4zrHjX9/PHz8+AkIMJ8fP378eCjGj+LHiB8/fgICzOPHj+M6148e148e148e148ex/jR/Cb+PX78+PEhIMB8fvx4XCM/x3WOG3/G40eP60eP4zrHjX9/PHz8+AkIMJ8fP378eCjGj+LHiB8/fgICzOPHj+M6148e148e148e148ex/jR/Cb+PX78+PEhIMB8fvx4XCM/x3WOG3/G40eP60eP4zrHjX9/PHz8+AkIMJ8fP378eCjGj+LHiB8/fgICzOPHj+M6148e148e148e148ex/jR/Cb+PX78+PEhIMB8fvx4XCM/x3WOG3/G40eP60eP4zrHjX9/PHz8+AkIMJ8fP378eCjGj+LHiB8/fgICzOPHj+M6148e148e148e148ex/jR/Cb+PX78+PEhIMB8fvx4XCM/x3WOG3/G40eP60eP4zrHjX9/PHz8+AkIMJ8fP378eCjGj+LHiB8/fgICzOPHj+M6148e148e148e148ex/jR/Cb+PX78+PEhIMB8fvx4XCM/x3WOG3/G40eP60eP4zrHjX9/PHz8+AkIMJ8fP378eCjGj+LHiB8/fgICzOPHj+M6148e148e148e148ex/jR/Cb+PX78+PEhIMB8fvx4XCM/x3WOG3/G40eP60eP4zrHjX9/PHz8+AkIMJ8fP378eCjGj+LHiB8/fgICzOPHj+M6148e148e148e148ex/jR/Cb+PX78+PEhIMB8fvx4XCM/x3WOG3/G40eP60eP4zrHjX9/PHz8+AkIMJ8fP378+AHA/weAP378+PEA8U/8AwDUA23yvJbUuQAAAABJRU5ErkJggg==',
    createdAt: new Date(Date.now() - 3 * 24 * 60 * 60 * 1000).toISOString(),
    status: 'Open',
  });
}

export async function getAllComplaints(): Promise<Complaint[]> {
  // Simulate network delay
  await new Promise(resolve => setTimeout(resolve, 500));
  return [...complaints].sort((a, b) => new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime());
}

export async function addComplaint(complaintData: Omit<Complaint, 'id' | 'createdAt' | 'status'>): Promise<Complaint> {
  await new Promise(resolve => setTimeout(resolve, 500));
  const newComplaint: Complaint = {
    ...complaintData,
    id: (nextId++).toString(),
    createdAt: new Date().toISOString(),
    status: 'Open',
  };
  complaints.unshift(newComplaint);
  return newComplaint;
}

export async function updateComplaintStatus(id: string, status: ComplaintStatus): Promise<Complaint | undefined> {
  await new Promise(resolve => setTimeout(resolve, 300));
  const complaintIndex = complaints.findIndex(c => c.id === id);
  if (complaintIndex !== -1) {
    complaints[complaintIndex].status = status;
    return complaints[complaintIndex];
  }
  return undefined;
}
